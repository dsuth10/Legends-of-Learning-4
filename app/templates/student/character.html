{% extends "base.html" %}

{% block title %}Character{% endblock %}

{% block content %}
<div class="container mt-5">
    {% if main_character %}
        <h2 class="mb-4">Your Character</h2>
        <div class="row">
            <div class="col-md-3">
                <img src="{{ main_character.avatar_url }}" alt="Avatar" class="img-thumbnail mb-3" style="width:128px;height:128px;">
            </div>
            <div class="col-md-9">
                <table class="table table-bordered w-auto">
                    <tr><th>Name</th><td>{{ main_character.name }}</td></tr>
                    <tr><th>Class</th><td>{{ main_character.character_class }}</td></tr>
                    <tr><th>Gender</th><td>{{ main_character.gender }}</td></tr>
                    <tr><th>Level</th><td>{{ main_character.level }}</td></tr>
                    <tr><th>XP</th><td>{{ main_character.experience }}</td></tr>
                    <tr><th>Health</th><td>{{ main_character.total_health }} <span class="text-muted small">(Base: {{ main_character.health }})</span></td></tr>
                    <tr><th>Strength</th><td>{{ main_character.total_strength }} <span class="text-muted small">(Base: {{ main_character.strength }})</span></td></tr>
                    <tr><th>Defense</th><td>{{ main_character.total_defense }} <span class="text-muted small">(Base: {{ main_character.defense }})</span></td></tr>
                    <tr><th>Gold</th><td>{{ main_character.gold }}</td></tr>
                </table>
                <h4>Equipped Items</h4>
                <table class="table table-bordered w-auto">
                    <tr>
                        <th>Weapon</th>
                        <td>
                            {% if main_character.equipped_weapon %}
                                {{ main_character.equipped_weapon.equipment.name }}
                                <span class="text-muted small">
                                    (Health: {{ main_character.equipped_weapon.equipment.health_bonus }},
                                    Strength: {{ main_character.equipped_weapon.equipment.strength_bonus }},
                                    Defense: {{ main_character.equipped_weapon.equipment.defense_bonus }})
                                </span>
                                <form method="POST" action="{{ url_for('student.unequip_weapon') }}" style="display:inline-block;margin-left:10px;">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Unequip</button>
                                </form>
                            {% else %}None{% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Armor</th>
                        <td>
                            {% if main_character.equipped_armor %}
                                {{ main_character.equipped_armor.equipment.name }}
                                <span class="text-muted small">
                                    (Health: {{ main_character.equipped_armor.equipment.health_bonus }},
                                    Strength: {{ main_character.equipped_armor.equipment.strength_bonus }},
                                    Defense: {{ main_character.equipped_armor.equipment.defense_bonus }})
                                </span>
                                <form method="POST" action="{{ url_for('student.unequip_armor') }}" style="display:inline-block;margin-left:10px;">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Unequip</button>
                                </form>
                            {% else %}None{% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>Accessory</th>
                        <td>
                            {% if main_character.equipped_accessory %}
                                {{ main_character.equipped_accessory.equipment.name }}
                                <span class="text-muted small">
                                    (Health: {{ main_character.equipped_accessory.equipment.health_bonus }},
                                    Strength: {{ main_character.equipped_accessory.equipment.strength_bonus }},
                                    Defense: {{ main_character.equipped_accessory.equipment.defense_bonus }})
                                </span>
                                <form method="POST" action="{{ url_for('student.unequip_accessory') }}" style="display:inline-block;margin-left:10px;">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Unequip</button>
                                </form>
                            {% else %}None{% endif %}
                        </td>
                    </tr>
                </table>
                <h4>Inventory (Unequipped Items)</h4>
                <table class="table table-bordered w-auto">
                    <tr>
                        <th>Type</th>
                        <th>Name</th>
                        <th>Bonuses</th>
                        <th>Action</th>
                    </tr>
                    {% for item in main_character.inventory_items if not item.is_equipped %}
                        <tr>
                            <td>{{ item.equipment.type.value.title() }}</td>
                            <td>{{ item.equipment.name }}</td>
                            <td>
                                <span class="text-muted small">
                                    Health: {{ item.equipment.health_bonus }},
                                    Strength: {{ item.equipment.strength_bonus }},
                                    Defense: {{ item.equipment.defense_bonus }}
                                </span>
                            </td>
                            <td>
                                <form method="POST" action="{{ url_for('student.equip_item', item_id=item.id) }}" style="display:inline;">
                                    <button type="submit" class="btn btn-success btn-sm">Equip</button>
                                </form>
                            </td>
                        </tr>
                    {% else %}
                        <tr><td colspan="4" class="text-muted">No unequipped items in inventory.</td></tr>
                    {% endfor %}
                </table>
                <div class="mb-3">
                    <form method="POST" action="{{ url_for('student.add_test_weapon') }}" style="display:inline-block">
                        <button type="submit" class="btn btn-outline-primary">Add Test Weapon</button>
                    </form>
                    <form method="POST" action="{{ url_for('student.add_test_armor') }}" style="display:inline-block">
                        <button type="submit" class="btn btn-outline-secondary">Add Test Armor</button>
                    </form>
                    <form method="POST" action="{{ url_for('student.add_test_accessory') }}" style="display:inline-block">
                        <button type="submit" class="btn btn-outline-success">Add Test Accessory</button>
                    </form>
                </div>
                <form method="POST" action="{{ url_for('student.gain_xp') }}">
                    <button type="submit" class="btn btn-warning">Gain 500 XP (Test Level Up)</button>
                </form>
            </div>
        </div>
        <p>View and customize your character, equipment, and abilities here.</p>
        <!-- Add character info, equipment, and abilities here -->
    {% else %}
        <div class="alert alert-info">You have not created a character yet.</div>
        <a href="{{ url_for('student.character_create') }}" class="btn btn-success">Create Your Character</a>
    {% endif %}
</div>
{% endblock %} 