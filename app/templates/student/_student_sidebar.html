{# Shared sidebar structure for student pages #}
{# This includes the character stats and navigation that appear on all student pages #}
{# Pages should extend this or include it and override sidebar_content block #}

<aside class="w-80 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-r border-gray-200 dark:border-gray-700 flex flex-col h-full overflow-y-auto custom-scrollbar shadow-2xl">
    {% if main_character %}
        {# Character header #}
        <div class="p-6 text-center">
            <h1 class="font-display text-4xl font-bold text-gray-800 dark:text-gray-100 leading-tight">
                {% set name_parts = main_character.name.split(' ') %}
                {{ name_parts[0] }}<br/>{{ name_parts[1] if name_parts|length > 1 else '' }}
            </h1>
            <p class="mt-2 text-gray-500 dark:text-gray-400 font-light text-lg">Level {{ main_character.level }} {{ main_character.character_class }}</p>
        </div>
        
        {# Stats bars #}
        <div class="px-4 space-y-3 mb-6">
            {# HP #}
            <div class="flex items-center">
                <span class="w-8 text-lg font-bold text-gray-600 dark:text-gray-300">HP</span>
                {% set max_hp = main_character.total_health %}
                {% set hp_percent = (main_character.health / max_hp * 100) if max_hp > 0 else 0 %}
                <div class="flex-1 h-8 bg-gray-200 dark:bg-gray-700 rounded-full relative overflow-hidden flex items-center">
                    <div class="absolute left-0 top-0 bottom-0 bg-hp-red" style="width: {{ hp_percent }}%"></div>
                    <div class="absolute left-1 z-10 w-8 h-6 bg-hp-red rounded-full flex items-center justify-center text-white text-xs font-bold shadow">{{ main_character.health }}</div>
                    <span class="ml-auto mr-2 text-xs text-gray-500 dark:text-gray-400 z-10">{{ max_hp }}</span>
                </div>
            </div>
            
            {# PP #}
            <div class="flex items-center">
                <span class="w-8 text-lg font-bold text-gray-600 dark:text-gray-300 uppercase">pp</span>
                {% set max_pp = main_character.total_power %}
                {% set pp_percent = (main_character.power / max_pp * 100) if max_pp > 0 else 0 %}
                <div class="flex-1 h-8 bg-gray-200 dark:bg-gray-700 rounded-full relative overflow-hidden flex items-center">
                    <div class="absolute left-0 top-0 bottom-0 bg-ap-blue" style="width: {{ pp_percent }}%"></div>
                    <div class="absolute left-1 z-10 w-8 h-6 bg-ap-blue rounded-full flex items-center justify-center text-white text-xs font-bold shadow">{{ main_character.power }}</div>
                    <span class="ml-auto mr-2 text-xs text-gray-500 dark:text-gray-400 z-10">{{ max_pp }}</span>
                </div>
            </div>
            
            {# XP #}
            <div class="flex items-center">
                <span class="w-8 text-lg font-bold text-gray-600 dark:text-gray-300">XP</span>
                {% set next_level_xp = (main_character.level * 1000) %}
                {% set xp_percent = (main_character.experience / next_level_xp * 100) if next_level_xp > 0 else 0 %}
                {% if xp_percent > 100 %}{% set xp_percent = 100 %}{% endif %}
                <div class="flex-1 h-8 bg-gray-200 dark:bg-gray-700 rounded-full relative overflow-hidden flex items-center justify-between px-3">
                    <div class="absolute left-0 top-0 bottom-0 bg-xp-yellow" style="width: {{ xp_percent }}%"></div>
                    <span class="relative z-10 text-xs font-bold text-white drop-shadow-md">{{ "{:,}".format(main_character.experience) }}</span>
                    <span class="relative z-10 text-xs text-white/80 drop-shadow-md">{{ "{:,}".format(next_level_xp) }}</span>
                </div>
            </div>
            
            {# GP #}
            <div class="flex items-center">
                <span class="w-8 text-lg font-bold text-gray-600 dark:text-gray-300">GP</span>
                <div class="flex-1 h-8 bg-gray-200 dark:bg-gray-700 rounded-full relative overflow-hidden flex items-center px-3">
                    <div class="absolute left-0 top-0 bottom-0 bg-gp-gold" style="width: 85%"></div>
                    <span class="relative z-10 text-xs font-bold text-white drop-shadow-md">{{ "{:,}".format(main_character.gold) }}</span>
                </div>
            </div>
        </div>
        
        {# Navigation buttons #}
        <div class="px-4 grid grid-cols-2 gap-3 mb-8">
            <a href="{{ url_for('student.quests') }}" class="w-full py-2 rounded-full bg-hp-red text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors font-bold text-sm tracking-wide">Quests</a>
            <a href="{{ url_for('student.shop') }}" class="w-full py-2 rounded-full bg-xp-yellow text-white flex items-center justify-center shadow-lg hover:bg-yellow-600 transition-colors font-bold text-sm tracking-wide">Shop</a>
            <a href="{{ url_for('student.progress') }}" class="w-full py-2 rounded-full bg-gp-gold text-white flex items-center justify-center shadow-lg hover:bg-yellow-700 transition-colors font-bold text-sm tracking-wide">Progress</a>
            <a href="{{ url_for('student.character') }}" class="w-full py-2 rounded-full bg-gray-800 dark:bg-gray-600 text-white flex items-center justify-center shadow-lg hover:bg-black transition-colors font-bold text-sm tracking-wide">Character</a>
        </div>
    {% endif %}
    
    {# Page-specific sidebar content #}
    {% block sidebar_content %}{% endblock %}
</aside>
